<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">
    <head th:replace="~{customer/fragments/common :: head}"></head>

    <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
        <div class="app-wrapper">
            <nav th:replace="~{customer/fragments/common :: nav}"></nav>

            <aside th:replace="~{customer/fragments/common :: aside}"></aside>

            <main class="app-main">
                <section>
                    <div class="header-inner">
                        <div class="inner text-center">
                            <h3 class="text-white uppercase"><strong>POSICIÓN ACTUAL CLIENTE</strong></h3>
                        </div>
                        <div class="overlay bg-opacity-5"></div>
                    </div>
                </section>
                <!-- end section -->
                 <br>

                <div class="app-content">
                    <div class="container-fluid">
                        <div class="col-12">
                            <ul class="nav nav-tabs mb-3" id="positionTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="detail-tab" data-bs-toggle="tab" data-bs-target="#detail-tab-pane" 
                                    type="button" role="tab" aria-controls="detail-tab-pane" aria-selected="true" tabindex="0">
                                        <strong>TOTAL INVERSIÓN</strong>
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="cash-tab" data-bs-toggle="tab" data-bs-target="#cash-tab-pane" 
                                    type="button" role="tab" aria-controls="cash-tab-pane" aria-selected="false" tabindex="-1">
                                        <strong>SALDO MN</strong>
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="stock-market-tab" data-bs-toggle="tab" data-bs-target="#stock-market-tab-pane" 
                                    type="button" role="tab" aria-controls="stock-market-tab-pane" aria-selected="false" tabindex="-1">
                                        <strong>MERCADO DE CAPITALES</strong>
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="money-market-tab" data-bs-toggle="tab" data-bs-target="#money-market-tab-pane" 
                                    type="button" role="tab" aria-controls="money-market-tab-pane" aria-selected="false" tabindex="-1">
                                        <strong>MERCADO DE DINERO</strong>
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation" hidden>
                                    <button class="nav-link" id="investment-funds-tab" data-bs-toggle="tab" data-bs-target="#investment-funds-tab-pane" 
                                    type="button" role="tab" aria-controls="investment-funds-tab-pane" aria-selected="false" tabindex="-1">
                                        <strong>FONDOS DE INVERSION</strong>
                                    </button>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane fade active show" id="detail-tab-pane" role="tabpanel" aria-labelledby="detail-tab" tabindex="0">
                                    <div class="row g-3">
                                        <div class="col-12 text-end">
                                            <a id="generalReportButton" class="btn btn-sm btn-primary" th:href="@{/portal-clientes/posicion/descargar-reporte?type=1}" target="_blank">
                                                <i class="fa fa-file-pdf"></i> Ver Reporte
                                            </a>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="table-responsive">
                                                <table class="table table-sm table-striped table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">MERCADO</th>
                                                            <th class="text-center">EMISORA - SERIE</th>
                                                            <th class="text-center">TÍTULOS</th>
                                                            <th class="text-center">COSTO PROMEDIO</th>
                                                            <th class="text-center">PRECIO</th>
                                                            <th class="text-center">VALOR</th>
                                                            <th class="text-center">% PORTAFOLIO</th>
                                                            <th class="text-center">PLUS/MINUS VALÍA</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr th:each="element : ${generalList}">
                                                            <td class="text-start" th:text="${element.market}"></td>
                                                            <td class="text-start">
                                                                <strong><span th:text="${element.emmiter}"></span></strong>
                                                                <span th:text="${element.serie}"></span>
                                                            </td>
                                                            <td class="text-end" th:text="${#numbers.formatDecimal(element.securities, 1, 'COMMA', 0, 'POINT')}"></td>
                                                            <td class="text-end" th:text="${#numbers.formatDecimal(element.averageAmount, 1, 'COMMA', 6, 'POINT')}"></td>
                                                            <td class="text-end" th:text="${#numbers.formatDecimal(element.marketPrice, 1, 'COMMA', 6, 'POINT')}"></td>
                                                            <td class="text-end" th:text="${#numbers.formatDecimal(element.marketValue, 1, 'COMMA', 2, 'POINT')}"></td>
                                                            <td class="text-end" th:text="${#numbers.formatDecimal(element.percentage, 1, 'COMMA', 6, 'POINT')}"></td>
                                                            <td class="text-end">
                                                                <strong>
                                                                    <span th:class="${element.cssStyle}" th:text="${#numbers.formatDecimal(element.capitalGainLoss, 1, 'COMMA', 2, 'POINT')}"></span>
                                                                </strong>
                                                            </td>
                                                        </th>
                                                        <tr>
                                                            <td class="text-end" colspan="5"><strong>TOTAL</strong></td>
                                                            <td class="text-end">
                                                                <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(generalList.![marketValue]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                            </td>
                                                            <td class="text-end">
                                                                <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(generalList.![percentage]), 1, 'COMMA', 6, 'POINT')}"></span></strong>
                                                            </td>
                                                            <td class="text-end">
                                                                <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(generalList.![capitalGainLoss]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="cash-tab-pane" role="tabpanel" aria-labelledby="cash-tab" tabindex="3">
                                    <div class="row g-3">
                                        <div class="col-12 text-end">
                                            <a id="cashButton" class="btn btn-sm btn-primary" hidden>
                                                <i class="fa fa-file-pdf"></i> Generar Reporte
                                            </a>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="table-responsive">
                                                <table class="table table-sm table-striped table-bordered">
                                                    <thead>
                                                        <th class="text-center" style="width: 70%;">MONEDA</th>
                                                        <th class="text-center">SALDO POR LIQUIDAR</th>
                                                        <th class="text-center">SALDO ACTUAL</th>
                                                    </thead>
                                                    <tbody>
                                                        <tr th:each="saldo : ${cashList}">
                                                            <td class="text-start" th:text="${saldo.currencyName}"></td>
                                                            <td class="text-end" th:text="${#numbers.formatDecimal(saldo.pendingBalance, 1, 'COMMA', 2, 'POINT')}"></td>
                                                            <td class="text-end" th:text="${#numbers.formatDecimal(saldo.currentBalance, 1, 'COMMA', 2, 'POINT')}"></td>
                                                        </tr>
                                                        <tr>
                                                            <td class="text-end"><strong>TOTAL</strong></td>
                                                            <td class="text-end">
                                                                <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(cashList.![pendingBalance]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                            </td>
                                                            <td class="text-end">
                                                                <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(cashList.![currentBalance]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="stock-market-tab-pane" role="tabpanel" aria-labelledby="stock-market-tab" tabindex="2">
                                    <div class="row g-3">
                                        <div class="col-12 text-end">
                                            <a id="stockMarketButton" class="btn btn-sm btn-primary" th:href="@{/portal-clientes/posicion/descargar-reporte?type=3}" target="_blank">
                                                <i class="fa fa-file-pdf"></i> Ver Reporte
                                            </a>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-12 table-responsive">
                                            <table class="table table-sm table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th class="text-center">EMISORA - SERIE</th>
                                                        <th class="text-center">TÍTULOS</th>
                                                        <th class="text-center">COSTO PROMEDIO</th>
                                                        <th class="text-center">PRECIO DE MERCADO ACTUAL</th>
                                                        <th class="text-center">VALOR A MERCADO ACTUAL</th>
                                                        <th class="text-center">PLUSVALÍA/MINUSVALÍA</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="posicion : ${positionStockList}">
                                                        <td>
                                                            <strong><span th:text="${posicion.emmiter}"></span></strong>
                                                            <span th:text="${posicion.serie}"></span>
                                                        </td>
                                                        <td class="text-end" th:text="${#numbers.formatDecimal(posicion.securities, 1, 'COMMA', 0, 'POINT')}"></td>
                                                        <td class="text-end" th:text="${#numbers.formatDecimal(posicion.averageAmount, 1, 'COMMA', 6, 'POINT')}"></td>
                                                        <td class="text-end" th:text="${#numbers.formatDecimal(posicion.marketPrice, 1, 'COMMA', 6, 'POINT')}"></td>
                                                        <td class="text-end" th:text="${#numbers.formatDecimal(posicion.marketValue, 1, 'COMMA', 2, 'POINT')}"></td>
                                                        <td class="text-end">
                                                            <strong>
                                                                <span th:class="${posicion.cssStyle}" th:text="${#numbers.formatDecimal(posicion.capitalGainLoss, 1, 'COMMA', 2, 'POINT')}"></span>
                                                            </strong>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="4" class="text-end"><strong>TOTAL</strong></td>
                                                        <td class="text-end">
                                                            <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(positionStockList.![marketValue]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                        </td>
                                                        <td class="text-end">
                                                            <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(positionStockList.![capitalGainLoss]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="money-market-tab-pane" role="tabpanel" aria-labelledby="money-market-tab" tabindex="1">
                                    <div class="row g-3">
                                        <div class="col-12 text-end">
                                            <a id="moneyMarketButton" class="btn btn-sm btn-primary" th:href="@{/portal-clientes/posicion/descargar-reporte?type=4}" target="_blank">
                                                <i class="fa fa-file-pdf"></i> Ver Reporte
                                            </a>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row g-3">
                                        <h5>POSICIÓN EN DIRECTO</h5>
                                        <div class="col-12 table-responsive">
                                            <table class="table table-sm table-striped table-bordered">
                                                <thead>
                                                    <th class="text-center">EMISORA - SERIE</th>
                                                    <th class="text-center">PLAZO</th>
                                                    <th class="text-center">TASA (Cupón)</th>
                                                    <th class="text-center">TÍTULOS</th>
                                                    <th class="text-center">COSTO PROMEDIO</th>
                                                    <th class="text-center">PRECIO DE MERCADO ACTUAL</th>
                                                    <th class="text-center">VALOR A MERCADO ACTUAL</th>
                                                    <th class="text-right">PLUSVALÍA / MINUSVALÍA</th>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="posicion : ${moneyMarketDirectPositionList}">
                                                        <td class="text-start">
                                                            <strong><span th:text="${posicion.emmiter}"></span></strong>
                                                            <span th:text="${posicion.serie}"></span>
                                                        </td>
                                                        <td th:text="${posicion.period}" class="text-center"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.rate, 1, 'COMMA', 2, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.securities, 1, 'COMMA', 0, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.averageAmount, 1, 'COMMA', 6, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.marketPrice, 1, 'COMMA', 6, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.marketValue, 1, 'COMMA', 2, 'POINT')}" class="text-end"></td>
                                                        <td class="text-end">
                                                            <strong>
                                                                <span th:class="${posicion.cssStyle}" th:text="${#numbers.formatDecimal(posicion.capitalGainLoss, 1, 'COMMA', 2, 'POINT')}"></span>
                                                            </strong>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="6" class="text-end"><strong>TOTAL</strong></td>
                                                        <td class="text-end">
                                                            <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(moneyMarketDirectPositionList.![marketValue]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                        </td>
                                                        <td class="text-end">
                                                            <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(moneyMarketDirectPositionList.![capitalGainLoss]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row g-3">
                                        <h5>POSICIÓN EN REPORTO</h5>
                                        <div class="col-12 table-responsive">
                                            <table class="table table-sm table-striped table-bordered">
                                                <thead>
                                                    <th class="text-center">EMISORA - SERIE</th>
                                                    <th class="text-center">PLAZO</th>
                                                    <th class="text-center">FECHA INICIAL</th>
                                                    <th class="text-center">TASA (Cupón)</th>
                                                    <th class="text-center">TÍTULOS</th>
                                                    <th class="text-center">COSTO PROMEDIO</th>
                                                    <th class="text-center">VALOR A COSTO</th>
                                                    <th class="text-center">VALOR A MERCADO ACTUAL</th>
                                                    <th class="text-right">PLUSVALÍA / MINUSVALÍA</th>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="posicion : ${moneyMarketReportPositionList}">
                                                        <td class="text-start">
                                                            <strong><span th:text="${posicion.emmiter}"></span></strong>
                                                            <span th:text="${posicion.serie}"></span>
                                                        </td>
                                                        <td th:text="${posicion.period}" class="text-center"></td>
                                                        <td th:if="${posicion.emmiter == 'REPORTO'}"></td>
                                                        <td th:unless="${posicion.emmiter == 'REPORTO'}" th:text="${posicion.averageDate}" class="text-center"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.rate, 1, 'COMMA', 2, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.securities, 1, 'COMMA', 0, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.averageAmount, 1, 'COMMA', 6, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.amount, 1, 'COMMA', 2, 'POINT')}" class="text-end"></td>
                                                        <td th:text="${#numbers.formatDecimal(posicion.marketValue, 1, 'COMMA', 2, 'POINT')}" class="text-end"></td>
                                                        <td class="text-end">
                                                            <strong>
                                                                <span th:class="${posicion.cssStyle}" th:text="${#numbers.formatDecimal(posicion.capitalGainLoss, 1, 'COMMA', 2, 'POINT')}"></span>
                                                            </strong>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="7" class="text-end"><strong>TOTAL</strong></td>
                                                        <td class="text-end">
                                                            <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(moneyMarketReportPositionList.![marketValue]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                        </td>
                                                        <td class="text-end">
                                                            <strong><span th:text="${#numbers.formatDecimal(#aggregates.sum(moneyMarketReportPositionList.![capitalGainLoss]), 1, 'COMMA', 2, 'POINT')}"></span></strong>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    
                                </div>
                                <div hidden class="tab-pane fade" id="investment-funds-tab-pane" role="tabpanel" aria-labelledby="investment-funds-tab" tabindex="4">
                                    <div class="row g-3 text-end" hidden>
                                        <div class="col-12">
                                            <button class="btn btn-sm btn-primary">
                                                <i class="fa fa-file-pdf"></i> Generar Reporte
                                            </button>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row g-3">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <th>FECHA</th>
                                                    <th>EMISORA</th>
                                                    <th>SERIE</th>
                                                    <th>TITULOS</th>
                                                    <th>PRECIO X TITULOS</th>
                                                    <th>COSTO PROMEDIO</th>
                                                    <th>VALOR MERCADO</th>
                                                    <th>PLUSVALÍA / MINUSVALÍA</th>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="posicion : ${positionFundsList}">
                                                        <td th:text="${posicion.emmiter}"></td>
                                                        <td th:text="${posicion.serie}"></td>
                                                        <td th:text="${posicion.marketPrice}"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container-fluid">
                            
                            
                        </div>
                    </div>
                </div>
            </main>

            <footer th:replace="~{customer/fragments/common :: footer}"></footer>
        </div>

        <div th:replace="~{customer/fragments/common :: jsDependencies}"></div>
    </body>
</html>